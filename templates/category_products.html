{% extends "base.html" %}
{% block title %}{{ category|capitalize }} Products - Amma's Kitchen{% endblock %}

{% block content %}
<section class="pt-5 pb-5" style="background: #fff;">
  <div class="container" style="margin-top:32px; margin-bottom:64px;">
    <div class="row">
      <!-- Left filter sidebar -->
      <div class="col-lg-3 mb-4">
        <div class="border rounded-4 p-3 bg-white shadow mb-4">
          <h6 class="fw-bold mb-3 text-primary">Filter</h6>
          <form id="filterForm">
            <div class="mb-3">
              <label class="form-label mb-1">Price</label>
              <input type="range" class="form-range" min="0" max="1000" step="10" id="priceRange" name="price">
              <span id="priceVal" class="fw-semibold"></span>
            </div>
            <div class="mb-3">
              <label class="form-label mb-1">Stock</label>
              <input type="range" class="form-range" min="0" max="100" step="1" id="stockRange" name="stock">
              <span id="stockVal" class="fw-semibold"></span>
            </div>
            <button type="submit" class="btn btn-primary btn-sm w-100">Apply</button>
          </form>
        </div>
      </div>

      <!-- Main content: products -->
      <div class="col-lg-9">
        <!-- Top controls: view toggle, sorting -->
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3 class="fw-bold fs-4">{{ category|capitalize }} Products</h3>
          <div>
            <button id="gridView" class="btn btn-outline-secondary btn-sm active"><i class="fa fa-th-large"></i></button>
            <button id="listView" class="btn btn-outline-secondary btn-sm"><i class="fa fa-list"></i></button>
          </div>
        </div>

        <!-- Products grid/list -->
        <div id="product-list" class="row g-4">
          {% for product in products %}
          <div class="col-md-4 product-card">
            <div class="card shadow h-100 rounded-4">
              <a href="{{ url_for('product_detail', product_id=product.id) }}">
                <img src="{{ url_for('static', filename=product.image_url) }}" class="card-img-top" alt="{{ product.name }}" style="height:220px; object-fit:cover;">
              </a>
              <!-- rest of your product card -->

              <div class="card-body py-3 px-2">
                <h6 class="card-title fw-bold mb-1" style="font-size:1rem;">{{ product.name }}</h6>
                <div class="fw-bold mb-1" style="color:#D32F2F;">₹{{ product.price }}</div>
                <div class="text-muted small">{{ product.stock }} in stock</div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</section>

<script>
// Price/stock value display
const price = document.getElementById('priceRange');
const stock = document.getElementById('stockRange');
const priceVal = document.getElementById('priceVal');
const stockVal = document.getElementById('stockVal');
if (price) price.addEventListener('input', () => priceVal.textContent = `₹${price.value}`);
if (stock) stock.addEventListener('input', () => stockVal.textContent = `${stock.value}`);
if (price) price.dispatchEvent(new Event('input'));
if (stock) stock.dispatchEvent(new Event('input'));

// List/grid toggle
document.getElementById('gridView').addEventListener('click', () => {
  document.getElementById('product-list').className = 'row g-4';
});
document.getElementById('listView').addEventListener('click', () => {
  document.getElementById('product-list').className = 'row flex-column';
  document.querySelectorAll('.product-card').forEach(card => card.className = 'col-12 product-card mb-4');
});

// Your filter JS/logic to submit and filter products here
</script>
{% endblock %}
