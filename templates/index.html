{% extends 'base.html' %}

{% block head %}
<style>
  /* MOBILE ONLY OVERRIDES */
  /* These use !important to override the inline styles only on small screens */
  @media (max-width: 768px) {
    /* Make the container full width on mobile */
    .mobile-container-fix {
      width: 100% !important; 
    }
    
    /* Reduce image height on mobile so it doesn't take up the whole screen */
    .mobile-img-fix {
      height: 250px !important;
    }

    /* Hide the carousel arrows on mobile to keep it clean */
    .carousel-control-prev, .carousel-control-next {
      display: none;
    }
  }
</style>
{% endblock %}

{% block content %}

    <section class="carousel-amma py-5" style="padding-left:0; padding-right:0; margin-left:0; margin-right:0;">
      
      <div class="mobile-container-fix" style="width:90%; margin:0 auto;">
        
        <div id="promoCarousel" class="carousel slide" data-bs-ride="carousel">
          <div class="carousel-inner">

            <div class="carousel-item active">
              <img src="{{ url_for('static', filename='images/car11.png') }}" 
                   alt="Freshly Ground Masalas" 
                   class="d-block w-100 shadow mobile-img-fix"
                   style="height:480px; object-fit:cover; border-radius:0;" />
            </div>

            <div class="carousel-item">
              <img src="{{ url_for('static', filename='images/car2.png') }}" 
                   alt="Homemade Ghee" 
                   class="d-block w-100 shadow mobile-img-fix"
                   style="height:480px; object-fit:cover; border-radius:0;" />
            </div>

            <div class="carousel-item">
              <img src="{{ url_for('static', filename='images/car333.png') }}" 
                   alt="Pure Dairy Products" 
                   class="d-block w-100 shadow mobile-img-fix"
                   style="height:480px; object-fit:cover; border-radius:0;" />
            </div>
            
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#promoCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#promoCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
          </button>
        </div>
      </div>
    </section>
    <br>

    <section class="py-5 overflow-hidden">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-12">

            <div class="section-header d-flex flex-wrap justify-content-between mb-5">
              <h2 class="section-title">Category</h2>

              <div class="d-flex align-items-center">
                <a href="#" class="btn-link text-decoration-none">View All Categories →</a>
                <div class="swiper-buttons d-none d-md-block"> <button class="swiper-prev category-carousel-prev btn btn-yellow">❮</button>
                  <button class="swiper-next category-carousel-next btn btn-yellow">❯</button>
                </div>
              </div>
            </div>
            
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <div class="category-carousel swiper">
              <div class="swiper-wrapper">
                  <a href="{{ url_for('category_products', category_name='masalas') }}" class="nav-link category-item swiper-slide">
                    <img src="{{ url_for('static', filename='images/category-masalas.png') }}" alt="Masalas">
                  </a>
                  <a href="{{ url_for('category_products', category_name='ghee') }}" class="nav-link category-item swiper-slide">
                    <img src="{{ url_for('static', filename='images/category/ghee.png') }}" alt="Ghee">
                  </a>
                  <a href="{{ url_for('category_products', category_name='chettinad') }}" class="nav-link category-item swiper-slide">
                    <img src="{{ url_for('static', filename='images/category/chettinad.png') }}" alt="Chettinad Snacks">
                  </a>
                  <a href="{{ url_for('category_products', category_name='dairy') }}" class="nav-link category-item swiper-slide">
                    <img src="{{ url_for('static', filename='images/category/dairy.png') }}" alt="Dairy">
                  </a>
                  <a href="{{ url_for('category_products', category_name='dosa') }}" class="nav-link category-item swiper-slide">
                    <img src="{{ url_for('static', filename='images/category/dosa.png') }}" alt="Dosa & Instant Mix">
                  </a>
                  <a href="{{ url_for('category_products', category_name='millet') }}" class="nav-link category-item swiper-slide">
                    <img src="{{ url_for('static', filename='images/category/millet.png') }}" alt="Millet Noodles">
                  </a>
                  <a href="{{ url_for('category_products', category_name='dhall') }}" class="nav-link category-item swiper-slide">
                    <img src="{{ url_for('static', filename='images/category/dhall.png') }}" alt="Dhall">
                  </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="trending-products" class="py-5">
      <div class="container-fluid">
        <div class="row mb-4">
          <div class="col text-center">
            <h3 class="mb-0 fw-bold" style="color:#be123c;">Trending Products</h3>
          </div>
        </div>
        <div class="row g-2 g-md-4" id="product-list">
          {% for p in products %}
          <div class="col-6 col-md-4 col-lg-3 col-xl-2 product-card mb-4">
            <div class="card h-100 shadow rounded-4">
              <a href="{{ url_for('product_detail', product_id=p.id) }}">
                <img src="{{ url_for('static', filename=p.image_url) }}"
                    class="card-img-top" alt="{{ p.name }}">
              </a>
              <div class="card-body d-flex flex-column justify-content-between p-2 p-md-3">
                <div>
                  <h5 class="card-title text-truncate">{{ p.name }}</h5>
                  <div class="small text-muted">{{ p.qty }}</div>
                  <div class="d-flex align-items-center mt-1">
                    <span class="badge bg-warning text-dark me-2">{{ p.rating }}</span>
                    <svg width="18" height="18" class="text-primary"><use xlink:href="#star-solid"></use></svg>
                  </div>
                  <div class="fw-bold fs-5 mt-2" style="color:#b91c1c;">₹{{ p.price }}</div>
                </div>
                <form class="add-to-cart-form d-flex flex-wrap align-items-center gap-2 mt-3"
                      data-product-id="{{ p.id }}"
                      data-product-name="{{ p.name }}"
                      data-product-price="{{ p.price }}">
                  <div class="input-group input-group-sm w-100">
                    <button type="button" class="btn btn-outline-secondary btn-qty" data-action="decrease">-</button>
                    <input type="number" min="1" value="1" class="form-control text-center qty-input" style="max-width:50px;">
                    <button type="button" class="btn btn-outline-secondary btn-qty" data-action="increase">+</button>
                    <button type="submit" class="btn btn-success btn-sm flex-fill">
                      <i class="bi bi-cart"></i> <span class="d-none d-lg-inline">Add to Cart</span><span class="d-inline d-lg-none">Add</span>
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
        {% if has_next %}
        <div class="text-center mt-4 w-100">
          <button id="load-more-btn" class="btn btn-outline-primary btn-lg"
                  data-next-page="{{ next_page }}">
            Load More
          </button>
        </div>
        {% endif %}
      </div>
    </section>

    <section class="py-5">
      <div class="container-fluid">
        <div class="row g-3 g-md-4">
          <div class="col-md-6">
            <div class="p-0 rounded-4 overflow-hidden" style="min-height:200px; height:100%;">
              <img src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/e8268c81-27ba-4c8f-b54b-f72d69fece37.png" 
                  alt="Homemade Masalas" 
                  class="w-100 h-100 object-fit-cover mobile-banner-fix" style="min-height:300px;">
            </div>
          </div>
          <div class="col-md-6">
            <div class="p-0 rounded-4 overflow-hidden" style="min-height:200px; height:100%;">
              <img src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/efa2fea4-4f03-4f9b-ac52-120770bf8e85.png" 
                  alt="Chettinad Snacks" 
                  class="w-100 h-100 object-fit-cover mobile-banner-fix" style="min-height:300px;">
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="py-5" style="background: radial-gradient(circle at 65% 20%, #fff7e6 60%, #fecaca 100%);">
      <div class="container-fluid">
        <div class="py-5 my-5 rounded-5 border-0 shadow-lg text-dark"
            style="background: rgba(255,255,255,0.8); box-shadow: 0 4px 32px 0 #fca5a533;">
          <div class="container my-3 my-lg-5">
            <div class="row align-items-center justify-content-center">

              <div class="col-lg-6 p-4 p-lg-5">
                <div class="section-header mb-4">
                  <h2 class="section-title display-5 fw-bold" style="color: #be123c;">
                    Get <span class="fw-bold" style="background: linear-gradient(90deg,#f59e0b,#e11d48); -webkit-background-clip: text; color: transparent;">25% Discount</span><br>
                    <span style="color: #d97706;">Homemade Masalas & Snacks</span>
                  </h2>
                </div>
                <p class="lead mb-3" style="font-size:1.25rem;">
                  <strong>Amma’s Kitchen:</strong> authentic, homemade masalas and Chettinad snacks,<br>
                  freshly prepared and delivered to your doorstep.<br>
                  <span style="color:#f59e0b; font-weight:bold;">Taste tradition with every bite!</span>
                </p>
                <ul class="list-unstyled mb-0">
                  <li class="mb-2"><span class="badge bg-warning text-dark fs-6 rounded-pill shadow-sm">No Colors</span></li>
                  <li class="mb-2"><span class="badge bg-warning text-dark fs-6 rounded-pill shadow-sm">No Preservatives</span></li>
                  <li><span class="badge bg-success text-light fs-6 rounded-pill shadow-sm">Free Home Delivery</span></li>
                </ul>
              </div>

              <div class="col-lg-6 p-4 p-lg-5 bg-white rounded-4 shadow-lg border-0">
                <form>
                  <div class="mb-3">
                    <label for="name" class="form-label fw-bold text-dark">Name</label>
                    <input type="text" class="form-control form-control-lg rounded-4" name="name" id="name" placeholder="Please enter your name">
                  </div>
                  <div class="mb-3">
                    <label for="email" class="form-label fw-bold text-dark">Email</label>
                    <input type="email" class="form-control form-control-lg rounded-4" name="email" id="email" placeholder="Please enter your email address">
                  </div>
                  <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" id="subscribe" value="subscribe">
                    <label class="form-check-label text-dark" for="subscribe">
                      Subscribe for offers & recipes
                    </label>
                  </div>
                  <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-danger btn-lg text-uppercase fw-bold shadow"
                        style="background: linear-gradient(90deg,#f59e0b,#e11d48); border: none;">
                      Claim My Discount
                    </button>
                  </div>
                </form>
              </div>

            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="py-5">
      <div class="container-fluid">
        <div class="row align-items-center">
          <div class="section-header d-flex flex-wrap align-items-center justify-content-between my-4">
            <div class="mb-3 mb-md-0">
              <h2 class="section-title mb-1 fw-bold" style="color:#be123c;">What Our Customers Say</h2>
              <div class="d-flex align-items-center gap-2 small text-muted">
                <span class="ms-1 fw-bold" style="color:#d97706;">4.9/5 · 1,200+ reviews</span>
              </div>
            </div>
            <div class="btn-wrap align-right">
              <a href="#" class="btn btn-outline-danger btn-sm rounded-4 fw-bold shadow">Write a Review</a>
            </div>
          </div>
        </div>

        <div class="container-fluid">
          <div class="row mb-5">
            <div class="col-12 text-center">
              <h2 class="fw-bold" style="color: #be123c;">Customer Stories</h2>
              <p class="text-muted">Real reviews from real kitchens</p>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <div class="swiper reviews-swiper pb-5"> 
                <div class="swiper-wrapper">
                  <div class="swiper-slide h-auto"> <div class="testimonial-card">
                      <div class="testimonial-quote-icon">“</div>
                      <div class="d-flex align-items-center mb-4">
                        <div class="testimonial-avatar bg-danger-subtle text-danger">AK</div>
                        <div>
                          <h6 class="mb-0 fw-bold text-dark">Anitha K.</h6>
                          <div class="small text-muted">Coimbatore</div>
                        </div>
                        <div class="ms-auto star-rating text-warning"><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i></div>
                      </div>
                      <p class="testimonial-text">The <strong>Sambar Powder</strong> tastes exactly like my mom’s! Fresh aroma, no artificial color, perfect heat.</p>
                      <div class="d-flex flex-wrap gap-2 mt-auto"><span class="product-tag">Sambar Powder</span></div>
                    </div>
                  </div>
                  <div class="swiper-slide h-auto">
                    <div class="testimonial-card">
                      <div class="testimonial-quote-icon">“</div>
                      <div class="d-flex align-items-center mb-4">
                        <div class="testimonial-avatar bg-primary-subtle text-primary">RP</div>
                        <div>
                          <h6 class="mb-0 fw-bold text-dark">Rahul P.</h6>
                          <div class="small text-muted">Madurai</div>
                        </div>
                        <div class="ms-auto star-rating text-warning"><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i></div>
                      </div>
                      <p class="testimonial-text">Crispy <strong>Chettinad Snacks</strong>—the <em>Murukku</em> was super light. Great evening bites!</p>
                      <div class="d-flex flex-wrap gap-2 mt-auto"><span class="product-tag">Murukku</span></div>
                    </div>
                  </div>
                  <div class="swiper-slide h-auto">
                    <div class="testimonial-card">
                      <div class="testimonial-quote-icon">“</div>
                      <div class="d-flex align-items-center mb-4">
                        <div class="testimonial-avatar" style="background-color: #fce7f3; color: #be185d;">SV</div>
                        <div>
                          <h6 class="mb-0 fw-bold text-dark">Sowmya V.</h6>
                          <div class="small text-muted">Chennai</div>
                        </div>
                        <div class="ms-auto star-rating text-warning"><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i></div>
                      </div>
                      <p class="testimonial-text">Loved the <strong>Rasam Powder</strong>. Clean ingredients and the flavours really pop.</p>
                      <div class="d-flex flex-wrap gap-2 mt-auto"><span class="product-tag">Rasam Powder</span></div>
                    </div>
                  </div>
                </div>
                <div class="swiper-pagination reviews-pagination"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="py-5 perks-blur-bg">
      <div class="container">
        <div class="row g-4 justify-content-center">
          <div class="col-12 col-sm-6 col-lg-3">
            <div class="perk-card glass-card h-100 p-4 text-center position-relative shadow-lg border-0"
                style="background: rgba(255,247,230,0.85); border-radius: 2rem;">
              <div class="perk-icon display-5 mb-3 rounded-circle d-inline-flex align-items-center justify-content-center" style="background: #fef3c7; width:68px; height:68px; color: #d97706;">
                <svg width="40" height="40" fill="currentColor"><path d="M3 7h10v8H3zm11 2h3l3 3v3h-6zm-8 8a2 2 0 1 0 4 0zm8 0a2 2 0 1 0 4 0z"/></svg>
              </div>
              <h5 class="fw-bold mb-2" style="color:#be123c;">Free Home Delivery</h5>
              <p class="small text-muted mb-0">Fast delivery on local orders.</p>
            </div>
          </div>
          <div class="col-12 col-sm-6 col-lg-3">
            <div class="perk-card glass-card h-100 p-4 text-center position-relative shadow-lg border-0"
                style="background: rgba(245,158,11,0.13); border-radius: 2rem;">
              <div class="perk-icon display-5 mb-3 rounded-circle d-inline-flex align-items-center justify-content-center" style="background: #fff7ed; width:68px; height:68px; color:#f59e0b;">
                <svg width="40" height="40" fill="currentColor"><path d="M3 12a7 7 0 0 0 7 7h4a7 7 0 0 0 7-7zm4.5-6.5L15 13l1.5-1.5L9 4z"/></svg>
              </div>
              <h5 class="fw-bold mb-2" style="color: #be123c;">Hand-Roasted</h5>
              <p class="small text-muted mb-0">Stone-ground for aroma.</p>
            </div>
          </div>
          <div class="col-12 col-sm-6 col-lg-3">
            <div class="perk-card glass-card h-100 p-4 text-center position-relative shadow-lg border-0"
                style="background: rgba(252,165,165,0.22); border-radius: 2rem;">
              <div class="perk-icon display-5 mb-3 rounded-circle d-inline-flex align-items-center justify-content-center" style="background: #fca5a5; width:68px; height:68px; color:#b91c1c;">
                <svg width="40" height="40" fill="currentColor"><path d="M12 2l8 4v6a10 10 0 0 1-8 9a10 10 0 0 1-8-9V6zM10.5 14.5l-2.5-2.5l-1.5 1.5l4 4l7-7l-1.5-1.5z"/></svg>
              </div>
              <h5 class="fw-bold mb-2" style="color: #be123c;">100% Secure</h5>
              <p class="small text-muted mb-0">UPI / Cards / Net-banking.</p>
            </div>
          </div>
          <div class="col-12 col-sm-6 col-lg-3">
            <div class="perk-card glass-card h-100 p-4 text-center position-relative shadow-lg border-0"
                style="background: rgba(236,255,200,0.20); border-radius: 2rem;">
              <div class="perk-icon display-5 mb-3 rounded-circle d-inline-flex align-items-center justify-content-center" style="background: #dcfce7; width:68px; height:68px; color:#16a34a;">
                <svg width="40" height="40" fill="currentColor"><path d="M12 3C7 3 3 7 3 12s4 9 9 9c6 0 9-5 9-9c0-6-5-9-9-9m5 8c-3 1-6 3-8 6c1-3 3-6 6-8c-3 1-6 3-8 6c1-4 4-7 8-8c2 1 3 2 2 4Z"/></svg>
              </div>
              <h5 class="fw-bold mb-2" style="color: #be123c;">Freshness Guarantee</h5>
              <p class="small text-muted mb-0">Ground-to-pack within hours.</p>
            </div>
          </div>
        </div>
      </div>
    </section>
    <br>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const grid = document.getElementById('product-list');
  const loadBtn = document.getElementById('load-more-btn');

  if (loadBtn) {
    loadBtn.addEventListener('click', function() {
      const currentPageToLoad = this.getAttribute('data-next-page');
      
      const originalText = this.innerText;
      this.innerText = "Loading...";
      this.disabled = true;

      fetch(`/load-products?page=${currentPageToLoad}`)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');
          
          const newCards = doc.querySelectorAll('.product-card');
          newCards.forEach(card => grid.appendChild(card));

          const metadata = doc.getElementById('next-page-metadata');
          
          if (metadata && metadata.getAttribute('data-next-page') !== 'None') {
            loadBtn.setAttribute('data-next-page', metadata.getAttribute('data-next-page'));
            loadBtn.innerText = originalText;
            loadBtn.disabled = false;
          } else {
            loadBtn.remove(); 
          }
        })
        .catch(err => {
          console.error('Error loading products:', err);
          this.innerText = "Error";
        });
    });
  }
});
</script>
{% endblock %}